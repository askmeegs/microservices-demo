# Ad Service

The Ad service is a gRPC-based microservice that provides advertisements based on context keys. If no context keys are provided, it returns a random selection of ads. This service is a component of the microservices-demo application.

## Functionality

The Ad service exposes a single gRPC endpoint, `getAds`, which accepts a list of context keys (strings) and returns a list of relevant ads. If the context keys are empty, a random set of ads is returned.

The service maintains a static, in-memory map of ads categorized by context keywords.

## Dependencies

The Ad service is built using Java and Gradle. Key dependencies include:

- **gRPC:** For handling RPC communication. The service implements the `AdServiceGrpc.AdServiceImplBase` interface generated from the `demo.proto` file.
- **Log4j 2:** For logging application events.
- **Google Guava:** For immutable collections (`ImmutableListMultimap`).

For a complete list of dependencies, see the `build.gradle` file.

## API

### `getAds(AdRequest) returns (AdResponse)`

- **Request:** `AdRequest`
  - `context_keys`: A list of strings representing the context for which to retrieve ads.
- **Response:** `AdResponse`
  - `ads`: A list of `Ad` objects, each containing:
    - `redirect_url`: The URL to which the ad redirects.
    - `text`: The ad's display text.

## Configuration

The Ad service can be configured using the following environment variables:

- `PORT`: The port on which the gRPC server listens. Defaults to `9555`.
- `DISABLE_STATS`: If set, disables statistics collection.
- `DISABLE_TRACING`: If set, disables tracing.

## Building and Running

### Building the Service

The Ad service uses Gradle to compile and build. The Gradle wrapper is included in the source code. To build the service, run the following command from the `src/adservice` directory:

```sh
./gradlew installDist
```

This will create an executable script at `src/adservice/build/install/adservice/bin/AdService`.

### Building the Docker Image

To build the Docker image for the Ad service, run the following command from the `src/adservice` directory:

```sh
docker build -t adservice .
```

### Running the Service

To run the service directly, use the script generated by the `installDist` task:

```sh
./build/install/adservice/bin/AdService
```

You can also run the service from the Docker image:

```sh
docker run -p 9555:9555 adservice
```